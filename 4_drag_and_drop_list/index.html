<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>Drag and Drop</title>
</head>

<body>
    <div class="title">
        <h2>I'm draggable, try!</h2>
    </div>
    <div class="container">

        <div id="left">
            <div class="list" draggable="true"><i class="fa-solid fa-ellipsis-vertical fa-lg"></i>List Item 1</div>
            <div class="list" draggable="true"><i class="fa-solid fa-ellipsis-vertical fa-lg"></i>List Item 2</div>
            <div class="list" draggable="true"><i class="fa-solid fa-ellipsis-vertical fa-lg"></i>List Item 3</div>
            <div class="list" draggable="true"><i class="fa-solid fa-ellipsis-vertical fa-lg"></i>List Item 4</div>
        </div>
        <div id="right">

        </div>
    </div>
</body>
<script>
const lists = document.getElementsByClassName('list');
const rightBox = document.getElementById('right');
const leftBox = document.getElementById('left');

// Function to determine if the drop is within the specified box
const isWithinBox = (box, x, y) => 
    x >= box.offsetLeft && x <= box.offsetLeft + box.offsetWidth &&
    y >= box.offsetTop && y <= box.offsetTop + box.offsetHeight;

// Function to handle the clone movement
const moveClone = (clone, offsetX, offsetY, pageX, pageY) => {
    clone.style.left = `${pageX - offsetX}px`;
    clone.style.top = `${pageY - offsetY}px`;
};

// Function to append the selected list to the appropriate box
const appendToList = (box, list) => {
    box && box.appendChild(list);
};

for (const list of lists) {
    list.addEventListener('touchstart', function(e) {
        let selectedList = e.target;
        const { clientX, clientY } = e.touches[0];
        const offsetX = clientX - selectedList.getBoundingClientRect().left;
        const offsetY = clientY - selectedList.getBoundingClientRect().top;
        let clone = selectedList.cloneNode(true);
        Object.assign(clone.style, {
            position: 'absolute',
            left: `${clientX - offsetX}px`,
            top: `${clientY - offsetY}px`,
            width: `${selectedList.offsetWidth}px`,
            height: `${selectedList.offsetHeight}px`,
            opacity: '0.7',
            pointerEvents: 'none',
        });
        document.body.appendChild(clone);

        const touchMoveHandler = (e) => {
            e.preventDefault();
            moveClone(clone, offsetX, offsetY, e.touches[0].pageX, e.touches[0].pageY);
        };

        const touchEndHandler = (e) => {
            const { clientX, clientY } = e.changedTouches[0];
            document.body.removeChild(clone);
            appendToList(isWithinBox(rightBox, clientX, clientY) ? rightBox :
                         isWithinBox(leftBox, clientX, clientY) ? leftBox : null, selectedList);
            document.removeEventListener('touchmove', touchMoveHandler);
            document.removeEventListener('touchend', touchEndHandler);
        };

        document.addEventListener('touchmove', touchMoveHandler, { passive: false });
        document.addEventListener('touchend', touchEndHandler, { passive: true }); // Marked as passive
    }, { passive: true }); // Marked touchstart as passive

    list.addEventListener('dragstart', function(e) {
        const selectedList = e.target;

        const dragOverHandler = (e) => {
            e.preventDefault();
        };

        const dropHandler = (box) => {
            return function(e) {
                appendToList(box, selectedList);
            };
        };

        rightBox.addEventListener('dragover', dragOverHandler);
        rightBox.addEventListener('drop', dropHandler(rightBox));
        leftBox.addEventListener('dragover', dragOverHandler);
        leftBox.addEventListener('drop', dropHandler(leftBox));
    });
}

</script>

</html>